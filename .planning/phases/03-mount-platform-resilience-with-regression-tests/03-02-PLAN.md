---
phase: 03-mount-platform-resilience-with-regression-tests
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - tests/run-shell-tests.sh
  - tests/spec/cobalt-docker.preflight-mount.sh
autonomous: true
requirements:
  - TEST-01
  - TEST-02
user_setup: []
must_haves:
  truths:
    - Automated shell tests validate launcher preflight error branches.
    - Automated shell tests validate mount-mode selection and profile-source branch behavior.
  artifacts:
    - tests/run-shell-tests.sh
    - tests/spec/cobalt-docker.preflight-mount.sh
  key_links:
    - test names/output identify specific preflight and mount branch failures.
    - tests run without requiring real Docker daemon side effects.
---

<objective>
Add regression coverage for launcher preflight and mount branches using a deterministic shell test harness.

Purpose: satisfy TEST-01 and TEST-02 while keeping tests lightweight and locally runnable.
Output: one-command shell runner plus branch-focused launcher spec tests.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-CONTEXT.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-RESEARCH.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-01-PLAN.md

@cobalt-docker.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shell regression runner with branch-identifying output</name>
  <files>tests/run-shell-tests.sh</files>
  <action>Create a test runner that executes spec scripts, reports pass/fail per spec, and exits non-zero on any failure.</action>
  <verify>bash tests/run-shell-tests.sh</verify>
  <done>Runner supports one-command execution and deterministic exit status.</done>
</task>

<task type="auto">
  <name>Task 2: Add preflight branch tests for launcher validation failures</name>
  <files>tests/spec/cobalt-docker.preflight-mount.sh</files>
  <action>Add fixture/stub-driven tests covering invalid boolean/port controls and clear branch-specific assertions on error output.</action>
  <verify>bash tests/spec/cobalt-docker.preflight-mount.sh</verify>
  <done>Preflight validation branches are regression-tested and failure output names broken contract branch.</done>
</task>

<task type="auto">
  <name>Task 3: Add mount-mode/profile-source branch tests</name>
  <files>tests/spec/cobalt-docker.preflight-mount.sh</files>
  <action>Add tests for bind success, fallback mode on daemon-invisible source, and profile-source visibility outputs using docker stubs.</action>
  <verify>bash tests/spec/cobalt-docker.preflight-mount.sh</verify>
  <done>Mount branch behavior is test-covered with explicit branch assertions.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] launcher preflight tests run and pass
- [ ] mount-mode branch tests run and pass
- [ ] `tests/run-shell-tests.sh` aggregates and reports status correctly
</verification>

<success_criteria>
- TEST-01 and TEST-02 are met via automated, repeatable shell tests.
- Test failures are branch-identifiable and actionable.
</success_criteria>

<output>
After completion, create `.planning/phases/03-mount-platform-resilience-with-regression-tests/03-02-SUMMARY.md`
</output>
