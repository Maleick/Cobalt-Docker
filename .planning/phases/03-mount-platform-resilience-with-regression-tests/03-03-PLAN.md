---
phase: 03-mount-platform-resilience-with-regression-tests
plan: 03
type: execute
wave: 3
depends_on:
  - 03-01
  - 03-02
files_modified:
  - docker-entrypoint.sh
  - tests/spec/docker-entrypoint.startup.sh
  - tests/run-shell-tests.sh
  - README.md
autonomous: true
requirements:
  - TEST-03
user_setup: []
must_haves:
  truths:
    - Automated shell tests cover startup sequencing and readiness failure branches in entrypoint behavior.
    - Startup branch regressions are surfaced with clear, phase-specific test failures.
  artifacts:
    - docker-entrypoint.sh
    - tests/spec/docker-entrypoint.startup.sh
    - tests/run-shell-tests.sh
  key_links:
    - startup marker/log sequence assertions map to teamserver->rest readiness contract.
    - test harness can run entrypoint branch coverage quickly with stubbed probes.
---

<objective>
Add startup sequencing/readiness regression tests and testability hooks needed to cover critical entrypoint branches.

Purpose: satisfy TEST-03 and lock in Phase 2 startup determinism guarantees with executable tests.
Output: entrypoint startup branch spec tests integrated into shell regression runner and documented usage.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-CONTEXT.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-RESEARCH.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-01-PLAN.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-02-PLAN.md

@docker-entrypoint.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add entrypoint testability controls for branch-speed regression runs</name>
  <files>docker-entrypoint.sh</files>
  <action>Introduce minimal testability hooks (for example overridable binary paths and probe timeout controls) without changing production startup contract semantics.</action>
  <verify>rg -n "STARTUP_PROBE_TIMEOUT_SECONDS|TEAMSERVER_BIN|REST_SERVER_DIR|REST_SERVER_BIN" docker-entrypoint.sh</verify>
  <done>Entrypoint remains production-equivalent but supports fast deterministic branch testing.</done>
</task>

<task type="auto">
  <name>Task 2: Add startup sequencing/readiness branch spec tests</name>
  <files>tests/spec/docker-entrypoint.startup.sh</files>
  <action>Create stub-driven tests validating readiness ordering, early process-exit handling, and readiness timeout failure branches with marker-based assertions.</action>
  <verify>bash tests/spec/docker-entrypoint.startup.sh</verify>
  <done>Startup sequencing/readiness branches are regression-tested with clear branch-specific failures.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate startup specs into runner and document test command</name>
  <files>tests/run-shell-tests.sh, README.md</files>
  <action>Wire startup spec into aggregate runner and document one-command test execution and expected output semantics for operators/contributors.</action>
  <verify>bash tests/run-shell-tests.sh</verify>
  <done>Single command executes full Phase 3 shell regression suite including startup coverage.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] entrypoint startup branch spec tests pass
- [ ] full shell regression suite passes from single command
- [ ] docs include test execution command and scope
</verification>

<success_criteria>
- TEST-03 is satisfied with automated sequencing/readiness branch coverage.
- Startup branch regressions become quickly detectable and diagnosable.
</success_criteria>

<output>
After completion, create `.planning/phases/03-mount-platform-resilience-with-regression-tests/03-03-SUMMARY.md`
</output>
