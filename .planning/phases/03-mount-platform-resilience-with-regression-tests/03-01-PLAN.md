---
phase: 03-mount-platform-resilience-with-regression-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - cobalt-docker.sh
  - .env.example
  - README.md
  - AGENTS.md
autonomous: true
requirements:
  - MNT-01
  - MNT-02
  - MNT-03
user_setup: []
must_haves:
  truths:
    - Launcher deterministically selects bind/fallback/none mount mode and surfaces decision branch explicitly.
    - Profile source is clearly surfaced as bind-mounted host profile or in-image fallback profile.
    - Host/runtime target detection handles platform variance with explicit failure guidance and override path.
  artifacts:
    - cobalt-docker.sh
    - README.md
    - AGENTS.md
  key_links:
    - mount probe outcomes map directly to visible mount-mode/profile-source output lines.
    - host/runtime detection contract and override behavior are documented in README/AGENTS.
---

<objective>
Harden launcher mount/platform behavior so mode/source selection and host detection are deterministic and operator-visible.

Purpose: satisfy Phase 3 mount/platform requirements before adding regression tests.
Output: explicit mount mode/source diagnostics, resilient host detection, and aligned docs/config contract.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-CONTEXT.md
@.planning/phases/03-mount-platform-resilience-with-regression-tests/03-RESEARCH.md

@cobalt-docker.sh
@README.md
@AGENTS.md
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make mount mode/profile source branch outputs explicit and deterministic</name>
  <files>cobalt-docker.sh</files>
  <action>Add stable branch outputs for mount mode and profile source in bind/fallback/none paths, including distinct messaging for source-missing versus daemon-invisible branches.</action>
  <verify>rg -n "Mount mode|Profile source|Fallback mode|daemon-visible|source path" cobalt-docker.sh</verify>
  <done>All mount branches emit explicit and branch-distinct mode/source diagnostics.</done>
</task>

<task type="auto">
  <name>Task 2: Harden host/runtime target detection across platform variance</name>
  <files>cobalt-docker.sh, .env.example</files>
  <action>Implement multi-strategy host detection for Linux/macOS with explicit override support and actionable failure remediation when detection cannot resolve a usable target.</action>
  <verify>rg -n "TEAMSERVER_HOST_OVERRIDE|detect_host|hostname -I|route -n get default|ipconfig getifaddr" cobalt-docker.sh .env.example</verify>
  <done>Host/runtime target detection is resilient, deterministic, and no longer fails silently on platform variance.</done>
</task>

<task type="auto">
  <name>Task 3: Align runtime docs and agent contract for mount/platform behavior</name>
  <files>README.md, AGENTS.md</files>
  <action>Update docs/contracts with mount-mode/profile-source outputs, host override behavior, and troubleshooting guidance for platform detection branches.</action>
  <verify>rg -n "Mount mode|Profile source|TEAMSERVER_HOST_OVERRIDE|platform|fallback" README.md AGENTS.md</verify>
  <done>Docs and agent instructions reflect launcher behavior with no contract drift.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `bash -n /opt/Cobalt-Docker/cobalt-docker.sh` passes
- [ ] mount mode/profile source output exists for all main branches
- [ ] host detection failure branch is actionable and override path documented
</verification>

<success_criteria>
- MNT-01, MNT-02, and MNT-03 are implemented with explicit operator diagnostics.
- Mount and host-variance behaviors are deterministic and testable.
</success_criteria>

<output>
After completion, create `.planning/phases/03-mount-platform-resilience-with-regression-tests/03-01-SUMMARY.md`
</output>
