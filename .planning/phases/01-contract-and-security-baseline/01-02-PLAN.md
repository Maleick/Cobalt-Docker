---
phase: 01-contract-and-security-baseline
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - cobalt-docker.sh
  - docker-entrypoint.sh
  - AGENTS.md
autonomous: true
requirements:
  - SEC-01
  - SEC-03
user_setup: []
must_haves:
  truths:
    - Runtime scripts avoid emitting raw secret values in normal error/status output.
    - A repeatable secret-pattern scan exists for planning/docs artifacts before commit.
  artifacts:
    - cobalt-docker.sh
    - docker-entrypoint.sh
    - AGENTS.md
  key_links:
    - Script logging patterns avoid direct secret output.
    - AGENTS guidance includes secret-safe handling and scan gate reference.
---

<objective>
Enforce secret-safe operational behavior and a repeatable doc/planning secret scan gate.

Purpose: Reduce accidental credential leakage risk in scripts and generated artifacts.
Output: Hardened logging expectations and explicit contributor guardrails for pre-commit scans.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/01-contract-and-security-baseline/01-CONTEXT.md
@.planning/phases/01-contract-and-security-baseline/01-RESEARCH.md

@cobalt-docker.sh
@docker-entrypoint.sh
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and harden script output for secret-safe messaging</name>
  <files>cobalt-docker.sh, docker-entrypoint.sh</files>
  <action>Review status/error output paths and ensure no raw secret values can be printed. Keep key names visible for diagnosis, but never values. Add brief comments where a future maintainer might reintroduce unsafe echo behavior.</action>
  <verify>rg -n "TEAMSERVER_PASSWORD|COBALTSTRIKE_LICENSE|TS_AUTHKEY|TS_API_KEY" cobalt-docker.sh docker-entrypoint.sh</verify>
  <done>Only key identifiers appear in messaging; values are not emitted.</done>
</task>

<task type="auto">
  <name>Task 2: Define a documented secret-pattern scan gate for docs/planning artifacts</name>
  <files>AGENTS.md</files>
  <action>Add a concise, reusable scan command to agent guidance for checking `.planning` and docs files for key/token patterns before commits. Keep command explicit and avoid shell constructs that obscure behavior.</action>
  <verify>rg -n "secret|scan|pattern|\.planning" AGENTS.md</verify>
  <done>Agent guidance includes a concrete scan step maintainers can run before committing docs/planning updates.</done>
</task>

<task type="auto">
  <name>Task 3: Validate phase doc artifacts against secret-pattern gate</name>
  <files>.planning/</files>
  <action>Run the documented scan against current `.planning` and markdown artifacts. If any hits occur, review and redact before finalizing this plan's summary.</action>
  <verify>grep -RE "(sk-[a-zA-Z0-9]{20,}|ghp_[a-zA-Z0-9]{36}|AKIA[A-Z0-9]{16}|-----BEGIN.*PRIVATE KEY|xox[baprs]-[a-zA-Z0-9-]+)" .planning *.md || true</verify>
  <done>No unreviewed secret-pattern hits remain in committed docs/planning artifacts.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Script logs/messages remain secret-safe
- [ ] Secret-pattern scan guidance added to AGENTS contract
- [ ] Current planning/docs artifacts pass scan or are reviewed/redacted
</verification>

<success_criteria>
- Secret-safe messaging is preserved in runtime scripts.
- Contributors have an explicit repeatable secret scan command.
- Planning/docs commits are gated by secret-pattern checks.
</success_criteria>

<output>
After completion, create `.planning/phases/01-contract-and-security-baseline/01-02-SUMMARY.md`
</output>
