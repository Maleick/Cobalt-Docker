---
phase: 02-startup-determinism-and-diagnostics
plan: 03
type: execute
wave: 3
depends_on:
  - 02-01
  - 02-02
files_modified:
  - docker-entrypoint.sh
  - README.md
  - AGENTS.md
autonomous: true
requirements:
  - STRT-03
  - STRT-04
user_setup: []
must_haves:
  truths:
    - Startup logs expose consistent phase markers and failure causes for fast diagnosis.
    - Documented health verification commands reliably confirm healthy startup behavior.
  artifacts:
    - docker-entrypoint.sh
    - README.md
    - AGENTS.md
  key_links:
    - Entrypoint startup phase markers are reflected in operator troubleshooting guidance.
    - README health verification commands match current runtime contract defaults.
---

<objective>
Finish Phase 2 by standardizing startup diagnostics and synchronizing verification guidance to satisfy STRT-03 and STRT-04.

Purpose: make startup health and failure triage repeatable from logs and docs alone.
Output: consistent startup markers in entrypoint output and updated docs for verification/troubleshooting.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/02-startup-determinism-and-diagnostics/02-CONTEXT.md
@.planning/phases/02-startup-determinism-and-diagnostics/02-RESEARCH.md
@.planning/phases/02-startup-determinism-and-diagnostics/02-01-PLAN.md
@.planning/phases/02-startup-determinism-and-diagnostics/02-02-PLAN.md

@docker-entrypoint.sh
@README.md
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add stable startup phase markers and failure cause prefixes</name>
  <files>docker-entrypoint.sh</files>
  <action>Standardize startup logs to deterministic phase markers for launch/readiness/monitor transitions, including failure branches with clear marker+cause output.</action>
  <verify>rg -n "STARTUP\\[|preflight|teamserver-ready|rest-ready|monitor" docker-entrypoint.sh</verify>
  <done>Entrypoint emits consistent startup markers for success and failure paths.</done>
</task>

<task type="auto">
  <name>Task 2: Align README verification and troubleshooting commands with startup contract</name>
  <files>README.md</files>
  <action>Update verification guidance to map directly to startup markers and health checks, including override-aware examples for REST publish port when non-default values are used.</action>
  <verify>rg -n "How to verify it is working|STARTUP\\[|REST_API_PUBLISH_PORT|health|openssl" README.md</verify>
  <done>README troubleshooting and verification flow matches current startup behavior and diagnostics.</done>
</task>

<task type="auto">
  <name>Task 3: Update AGENTS startup/diagnostic contract and run final phase checks</name>
  <files>AGENTS.md, scripts/scan-secrets.sh</files>
  <action>Document deterministic startup marker expectations in AGENTS guidance and run syntax + secret-scan checks before phase verification.</action>
  <verify>bash -n /opt/Cobalt-Docker/cobalt-docker.sh && bash -n /opt/Cobalt-Docker/docker-entrypoint.sh && ./scripts/scan-secrets.sh /opt/Cobalt-Docker</verify>
  <done>Agent guidance reflects startup diagnostics contract and validation checks pass cleanly.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] startup logs have stable phase markers across launch/readiness/failure branches
- [ ] docs health verification commands are runtime-aligned and operator-usable
- [ ] syntax + secret scan checks pass
</verification>

<success_criteria>
- STRT-03 and STRT-04 are demonstrably satisfied.
- Operators can verify and diagnose startup behavior quickly from logs/docs.
- Phase 2 is ready for verification and phase completion update.
</success_criteria>

<output>
After completion, create `.planning/phases/02-startup-determinism-and-diagnostics/02-03-SUMMARY.md`
</output>
